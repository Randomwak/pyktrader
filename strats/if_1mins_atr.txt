SWINGPRCNT1:=0.5;//定义参数SWINGPRCNT1
SWINGPRCNT2:=0.75;//定义参数SWINGPRCNT2
ATRLENGTH:=10;//定义参数ATRLENGTH
BOLLINGLENGTHS:=50; //定义参数BOLLINGLENGTHS
TRENDLIQLENGTH:=50; //定义参数TRENDLIQLENGTH
NUMSTDDEVS:=2;//定义参数NUMSTDDEVS
SWINGTRENDSWITCH:=50; //定义参数SWINGTRENDSWITCH
TR := MAX(MAX((HIGH-LOW),ABS(REF(CLOSE,1)-HIGH)),ABS(REF(CLOSE,1)-LOW));
CMIVAL:=ABS(REF(C,1)-REF(C,31))/(HHV(REF(H,1),30)-LLV(REF(L,1),30)); 
TRENDLOKSELL:=MA(REF(L,1),3*240/PERIOD); //定义变量TRENDLOKSELL 前一个周期的最低值在3*240除以当前图表周期的周期内的移动平均值
TRENDLOKBUY:=MA(REF(H,1),3*240/PERIOD); //定义变量TRENDLOKBUY 方法与TRENDLOKSELL同理
N:=BARSLAST(DATE<>REF(DATE,1))+1;//定义变量N 日内第一根K线到当前K线的周期数
OO:=VALUEWHEN(DATE<>REF(DATE,1),O);//定义变量OO 当天的开盘价
KEYOFDAY:=(HHV(H,N)+LLV(L,N)+C)/3;//定义变量 KEYOFDAY 日内最大值加上日内最小值 加上当前的收盘价 三者之和的平均值
SS1:=IFELSE(DATE<>REF(DATE,1)&&REF(C,N)>REF(KEYOFDAY,1),1,-1);
ATR:=EMA(TR,ATRLENGTH*240/PERIOD);//定义变量ATR TR在ATRLENGTH*240除以当前图表周期的周期内的平滑移动平均值
SB:=IFELSE(SS1=1,OO+SWINGPRCNT1*ATR,OO+SWINGPRCNT2*ATR);
SS:=IFELSE(SS1=-1,OO-SWINGPRCNT2*ATR,OO-SWINGPRCNT1*ATR);//定义变量SS  与SB同理
MA1:=MA(REF(C,1),TRENDLIQLENGTH);//定义变量MA1 一个周期前的收盘价 在TRENDLIQLENGTH周期内的移动平均值
MIDD:=MA(REF(C,1),BOLLINGLENGTHS);//定义变量MIDD 与变量MA1同理
TB:=MIDD+NUMSTDDEVS*STD(REF(C,1),BOLLINGLENGTHS);//定义变量TB MIDD+NUMSTDDEVS乘以一个周期前收盘价在BOLLINGLENGTHS周期内的标准差的值
TS:=MIDD-NUMSTDDEVS*STD(REF(C,1),BOLLINGLENGTHS);//定义变量TS 方法与TB同理
CMIVAL<SWINGTRENDSWITCH/100&&REF(H,1)>=SB,BPK;//满足条件CMIVAL小于SWINGTRENDSWITCH除以100 且一个周期前的H值大于等于SB 执行买平并买开
CMIVAL<SWINGTRENDSWITCH/100&&REF(L,1)<=SS,SPK;//满足条件CMIVAL小于SWINGTRENDSWITCH除以100 且一个周期前的L值小于等于SS 执行卖平并卖开
CMIVAL>=SWINGTRENDSWITCH/100&&REF(H,1)>=TB,BK;//满足条件CMIVAL大于等于SWINGTRENDSWITCH除以100 且一个周期前的H值大于等于TB 执行买开
CMIVAL>=SWINGTRENDSWITCH/100&&REF(L,1)<=TS,SK;//满足条件CMIVAL大于等于SWINGTRENDSWITCH除以100 且一个周期前的L值小于等于TS 执行卖开
REF(L,1)<=BKPRICE-3*ATR||REF(L,1)<=MA1,SP;//一个周期前的最低价 小于等于买开价格减去3倍的ATR 或者一个周期前的最低价小于等于MA1 执行卖平仓
REF(H,1)>=SKPRICE+3*ATR||REF(H,1)>=MA1,BP;//一个周期前的最高价 大于等于卖开价格加上3倍的ATR 或者一个周期前的最高价大于等于MA1 执行买平仓
AUTOFILTER; 
